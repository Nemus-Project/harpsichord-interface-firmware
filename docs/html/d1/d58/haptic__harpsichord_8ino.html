<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NEMUS Harpsichord Interface Firmware: src/haptic_harpsichord/haptic_harpsichord.ino File Reference</title>
<link rel="icon" href="../../favicon.ico" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">NEMUS Harpsichord Interface Firmware
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('d1/d58/haptic__harpsichord_8ino.html','../../',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">haptic_harpsichord.ino File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Main firmware file for Arduino IDE.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;Rotary.h&gt;</code><br />
<code>#include &lt;Button2.h&gt;</code><br />
<code>#include &lt;Adafruit_NeoPixel.h&gt;</code><br />
<code>#include &lt;Adafruit_FRAM_SPI.h&gt;</code><br />
<code>#include &lt;SPI.h&gt;</code><br />
<code>#include &quot;<a class="el" href="../../de/d11/error__codes_8h_source.html">error_codes.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-define-members" class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a69e988e6c98968a6cf9b9f1ce2ae5122" id="r_a69e988e6c98968a6cf9b9f1ce2ae5122"><td class="memItemLeft" align="right" valign="top"><a id="a69e988e6c98968a6cf9b9f1ce2ae5122" name="a69e988e6c98968a6cf9b9f1ce2ae5122"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ALWAYS_DEBUG</b>&#160;&#160;&#160;true</td></tr>
<tr class="memitem:a7d49a2be496c4d32a77a19922ceb3bdc" id="r_a7d49a2be496c4d32a77a19922ceb3bdc"><td class="memItemLeft" align="right" valign="top"><a id="a7d49a2be496c4d32a77a19922ceb3bdc" name="a7d49a2be496c4d32a77a19922ceb3bdc"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>numSensors</b>&#160;&#160;&#160;49</td></tr>
<tr class="memitem:af92a624bd5fe83c1bdf75090735177c7" id="r_af92a624bd5fe83c1bdf75090735177c7"><td class="memItemLeft" align="right" valign="top"><a id="af92a624bd5fe83c1bdf75090735177c7" name="af92a624bd5fe83c1bdf75090735177c7"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>numMuxChannels</b>&#160;&#160;&#160;7</td></tr>
<tr class="memitem:a780cd71d979fe2cb9cfc5a49b21f7be9" id="r_a780cd71d979fe2cb9cfc5a49b21f7be9"><td class="memItemLeft" align="right" valign="top"><a id="a780cd71d979fe2cb9cfc5a49b21f7be9" name="a780cd71d979fe2cb9cfc5a49b21f7be9"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>numPcbs</b>&#160;&#160;&#160;7</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-enum-members" class="groupheader"><a id="enum-members" name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:ac69029546da0ade2ad3f08952afadf5f" id="r_ac69029546da0ade2ad3f08952afadf5f"><td class="memItemLeft" align="right" valign="top"><a id="ac69029546da0ade2ad3f08952afadf5f" name="ac69029546da0ade2ad3f08952afadf5f"></a>enum &#160;</td><td class="memItemRight" valign="bottom"><b>JackState</b> { <br />
&#160;&#160;<b>PLUCKED</b>
, <b>PLUCK</b>
, <b>PRESSING</b>
, <b>RELEASING</b>
, <br />
&#160;&#160;<b>RELEASED</b>
, <b>UNKNOWN_KEY_STATE</b>
<br />
 }</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a9d70beff701e3b597b75e1e814f88f17" id="r_a9d70beff701e3b597b75e1e814f88f17"><td class="memItemLeft" align="right" valign="top">constexpr byte&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9d70beff701e3b597b75e1e814f88f17">key2index</a> (byte k)</td></tr>
<tr class="memdesc:a9d70beff701e3b597b75e1e814f88f17"><td class="mdescLeft">&#160;</td><td class="mdescRight">Key number to keyindex.  <br /></td></tr>
<tr class="memitem:a60ca3459b8849ad227d7927987577bfe" id="r_a60ca3459b8849ad227d7927987577bfe"><td class="memItemLeft" align="right" valign="top">byte&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a60ca3459b8849ad227d7927987577bfe">index2note</a> (byte index, byte transpose=0)</td></tr>
<tr class="memdesc:a60ca3459b8849ad227d7927987577bfe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Translate between key index and note.  <br /></td></tr>
<tr class="memitem:ab87f324bc11121b845d0d6bd14708954" id="r_ab87f324bc11121b845d0d6bd14708954"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab87f324bc11121b845d0d6bd14708954">rotate</a> (Rotary &amp;r)</td></tr>
<tr class="memdesc:ab87f324bc11121b845d0d6bd14708954"><td class="mdescLeft">&#160;</td><td class="mdescRight">Rotate callback.  <br /></td></tr>
<tr class="memitem:a32b5bd9df240aa826a6e9d9745844851" id="r_a32b5bd9df240aa826a6e9d9745844851"><td class="memItemLeft" align="right" valign="top"><a id="a32b5bd9df240aa826a6e9d9745844851" name="a32b5bd9df240aa826a6e9d9745844851"></a>
Adafruit_NeoPixel&#160;</td><td class="memItemRight" valign="bottom"><b>leds</b> (numSensors, ledPin, NEO_GRB+NEO_KHZ800)</td></tr>
<tr class="memitem:a4fc01d736fe50cf5b977f755b675f11d" id="r_a4fc01d736fe50cf5b977f755b675f11d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4fc01d736fe50cf5b977f755b675f11d">setup</a> ()</td></tr>
<tr class="memdesc:a4fc01d736fe50cf5b977f755b675f11d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Arduino setup function.  <br /></td></tr>
<tr class="memitem:afe461d27b9c48d5921c00d521181f12f" id="r_afe461d27b9c48d5921c00d521181f12f"><td class="memItemLeft" align="right" valign="top"><a id="afe461d27b9c48d5921c00d521181f12f" name="afe461d27b9c48d5921c00d521181f12f"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>loop</b> ()</td></tr>
<tr class="memdesc:afe461d27b9c48d5921c00d521181f12f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main firmware loop Listen to sensor values and generate MIDI one those thresholds have been crossed. <br /></td></tr>
<tr class="memitem:aaf407bc928ce2693bc7c429fea80687b" id="r_aaf407bc928ce2693bc7c429fea80687b"><td class="memItemLeft" align="right" valign="top">constexpr byte&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aaf407bc928ce2693bc7c429fea80687b">index2key</a> (byte i)</td></tr>
<tr class="memdesc:aaf407bc928ce2693bc7c429fea80687b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Translate from key index to key number.  <br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-var-members" class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:aea7feb135282e58c47825fa774c6000b" id="r_aea7feb135282e58c47825fa774c6000b"><td class="memItemLeft" align="right" valign="top"><a id="aea7feb135282e58c47825fa774c6000b" name="aea7feb135282e58c47825fa774c6000b"></a>
const unsigned long&#160;</td><td class="memItemRight" valign="bottom"><b>midiBaudRate</b> = 115200</td></tr>
<tr class="memdesc:aea7feb135282e58c47825fa774c6000b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Standard Baud Rate for MIDI. <br /></td></tr>
<tr class="memitem:a1178197637c3ebac3a8263e90f932077" id="r_a1178197637c3ebac3a8263e90f932077"><td class="memItemLeft" align="right" valign="top"><a id="a1178197637c3ebac3a8263e90f932077" name="a1178197637c3ebac3a8263e90f932077"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>executeDebugMode</b> = false</td></tr>
<tr class="memdesc:a1178197637c3ebac3a8263e90f932077"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flag to use in <span class="tt">setup</span> to enter debug mode. <br /></td></tr>
<tr class="memitem:ac640714f4e5c388e1f85d756e479b773" id="r_ac640714f4e5c388e1f85d756e479b773"><td class="memItemLeft" align="right" valign="top"><a id="ac640714f4e5c388e1f85d756e479b773" name="ac640714f4e5c388e1f85d756e479b773"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>isKeySelectMode</b> = true</td></tr>
<tr class="memdesc:ac640714f4e5c388e1f85d756e479b773"><td class="mdescLeft">&#160;</td><td class="mdescRight">Debug Mode Rotary behaviour flag. <br /></td></tr>
<tr class="memitem:a11b4a9a28e07ef304115b8861a91ff13" id="r_a11b4a9a28e07ef304115b8861a91ff13"><td class="memItemLeft" align="right" valign="top"><a id="a11b4a9a28e07ef304115b8861a91ff13" name="a11b4a9a28e07ef304115b8861a91ff13"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>curKeyIndex</b> = <a class="el" href="#a9d70beff701e3b597b75e1e814f88f17">key2index</a>(25)</td></tr>
<tr class="memdesc:a11b4a9a28e07ef304115b8861a91ff13"><td class="mdescLeft">&#160;</td><td class="mdescRight">Debug mode serial plot key index. <br /></td></tr>
<tr class="memitem:a33042120181267c44f20682ea91649b2" id="r_a33042120181267c44f20682ea91649b2"><td class="memItemLeft" align="right" valign="top"><a id="a33042120181267c44f20682ea91649b2" name="a33042120181267c44f20682ea91649b2"></a>
const size_t&#160;</td><td class="memItemRight" valign="bottom"><b>muxPinA</b> = 6</td></tr>
<tr class="memdesc:a33042120181267c44f20682ea91649b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mux Channel Set Pin A. <br /></td></tr>
<tr class="memitem:a94455a409009b3384ce666679c127959" id="r_a94455a409009b3384ce666679c127959"><td class="memItemLeft" align="right" valign="top"><a id="a94455a409009b3384ce666679c127959" name="a94455a409009b3384ce666679c127959"></a>
const size_t&#160;</td><td class="memItemRight" valign="bottom"><b>muxPinB</b> = 7</td></tr>
<tr class="memdesc:a94455a409009b3384ce666679c127959"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mux Channel Set Pin B. <br /></td></tr>
<tr class="memitem:aaa2a5e4d541ae893e1cc09d2f8e22c74" id="r_aaa2a5e4d541ae893e1cc09d2f8e22c74"><td class="memItemLeft" align="right" valign="top"><a id="aaa2a5e4d541ae893e1cc09d2f8e22c74" name="aaa2a5e4d541ae893e1cc09d2f8e22c74"></a>
const size_t&#160;</td><td class="memItemRight" valign="bottom"><b>muxPinC</b> = 8</td></tr>
<tr class="memdesc:aaa2a5e4d541ae893e1cc09d2f8e22c74"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mux Channel Set Pin C. <br /></td></tr>
<tr class="memitem:a6f12642e286d206a20c4bf1670150e98" id="r_a6f12642e286d206a20c4bf1670150e98"><td class="memItemLeft" align="right" valign="top"><a id="a6f12642e286d206a20c4bf1670150e98" name="a6f12642e286d206a20c4bf1670150e98"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><b>sensorReadingsA</b> [numSensors]</td></tr>
<tr class="memitem:a496c1688ad89f1cc1674e4dfbdf10da7" id="r_a496c1688ad89f1cc1674e4dfbdf10da7"><td class="memItemLeft" align="right" valign="top"><a id="a496c1688ad89f1cc1674e4dfbdf10da7" name="a496c1688ad89f1cc1674e4dfbdf10da7"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><b>sensorReadingsB</b> [numSensors]</td></tr>
<tr class="memitem:abaebb62ac347c7ba38901cda23097f70" id="r_abaebb62ac347c7ba38901cda23097f70"><td class="memItemLeft" align="right" valign="top"><a id="abaebb62ac347c7ba38901cda23097f70" name="abaebb62ac347c7ba38901cda23097f70"></a>
uint16_t *&#160;</td><td class="memItemRight" valign="bottom"><b>tempPointer</b></td></tr>
<tr class="memitem:a5c1e0ed6eb4b511b4bf870567c286a3c" id="r_a5c1e0ed6eb4b511b4bf870567c286a3c"><td class="memItemLeft" align="right" valign="top"><a id="a5c1e0ed6eb4b511b4bf870567c286a3c" name="a5c1e0ed6eb4b511b4bf870567c286a3c"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><b>sensorAvgMaxima</b> [numSensors]</td></tr>
<tr class="memitem:a0e8c6b54691d03836382538a64192677" id="r_a0e8c6b54691d03836382538a64192677"><td class="memItemLeft" align="right" valign="top"><a id="a0e8c6b54691d03836382538a64192677" name="a0e8c6b54691d03836382538a64192677"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><b>sensorAvgMinima</b> [numSensors]</td></tr>
<tr class="memitem:a9f79be7f6a68a5fec61b5267850b9bcd" id="r_a9f79be7f6a68a5fec61b5267850b9bcd"><td class="memItemLeft" align="right" valign="top"><a id="a9f79be7f6a68a5fec61b5267850b9bcd" name="a9f79be7f6a68a5fec61b5267850b9bcd"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><b>pluckThresholds</b> [numSensors]</td></tr>
<tr class="memitem:a709f5056fa7adf936b4bbccf36cc7e7e" id="r_a709f5056fa7adf936b4bbccf36cc7e7e"><td class="memItemLeft" align="right" valign="top"><a id="a709f5056fa7adf936b4bbccf36cc7e7e" name="a709f5056fa7adf936b4bbccf36cc7e7e"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><b>releaseThresholds</b> [numSensors]</td></tr>
<tr class="memitem:a714547e613237570ac6428543ba34588" id="r_a714547e613237570ac6428543ba34588"><td class="memItemLeft" align="right" valign="top"><a id="a714547e613237570ac6428543ba34588" name="a714547e613237570ac6428543ba34588"></a>
uint32_t&#160;</td><td class="memItemRight" valign="bottom"><b>readCount</b> = 0</td></tr>
<tr class="memitem:acb1f5c0b13336abef75561efcd9deae8" id="r_acb1f5c0b13336abef75561efcd9deae8"><td class="memItemLeft" align="right" valign="top"><a id="acb1f5c0b13336abef75561efcd9deae8" name="acb1f5c0b13336abef75561efcd9deae8"></a>
uint64_t&#160;</td><td class="memItemRight" valign="bottom"><b>lastRead</b> = 0</td></tr>
<tr class="memitem:a5d5a188e2d1cc790a8fc7eee99c3bc93" id="r_a5d5a188e2d1cc790a8fc7eee99c3bc93"><td class="memItemLeft" align="right" valign="top"><a id="a5d5a188e2d1cc790a8fc7eee99c3bc93" name="a5d5a188e2d1cc790a8fc7eee99c3bc93"></a>
constexpr byte&#160;</td><td class="memItemRight" valign="bottom"><b>avgSize</b> = 4</td></tr>
<tr class="memitem:ae8140190576c0c4e849ae54dfbd1f33a" id="r_ae8140190576c0c4e849ae54dfbd1f33a"><td class="memItemLeft" align="right" valign="top"><a id="ae8140190576c0c4e849ae54dfbd1f33a" name="ae8140190576c0c4e849ae54dfbd1f33a"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><b>sensorWindowReadings</b> [numSensors][avgSize]</td></tr>
<tr class="memitem:a6185ccbc65dec7bb19ec48dede723456" id="r_a6185ccbc65dec7bb19ec48dede723456"><td class="memItemLeft" align="right" valign="top"><a id="a6185ccbc65dec7bb19ec48dede723456" name="a6185ccbc65dec7bb19ec48dede723456"></a>
byte&#160;</td><td class="memItemRight" valign="bottom"><b>windex</b> = 0</td></tr>
<tr class="memitem:ab41bcc590998975e6907d7a7eac30236" id="r_ab41bcc590998975e6907d7a7eac30236"><td class="memItemLeft" align="right" valign="top"><a id="ab41bcc590998975e6907d7a7eac30236" name="ab41bcc590998975e6907d7a7eac30236"></a>
uint16_t *&#160;</td><td class="memItemRight" valign="bottom"><b>prevSensorReadings</b> = sensorReadingsB</td></tr>
<tr class="memitem:ad6a09c67323990d88f803621f61164c1" id="r_ad6a09c67323990d88f803621f61164c1"><td class="memItemLeft" align="right" valign="top"><a id="ad6a09c67323990d88f803621f61164c1" name="ad6a09c67323990d88f803621f61164c1"></a>
uint16_t *&#160;</td><td class="memItemRight" valign="bottom"><b>currSensorReadings</b> = sensorReadingsA</td></tr>
<tr class="memitem:a60a9de9464beb6a74cae1534a7782ed5" id="r_a60a9de9464beb6a74cae1534a7782ed5"><td class="memItemLeft" align="right" valign="top"><a id="a60a9de9464beb6a74cae1534a7782ed5" name="a60a9de9464beb6a74cae1534a7782ed5"></a>
JackState&#160;</td><td class="memItemRight" valign="bottom"><b>jackStatesA</b> [numSensors]</td></tr>
<tr class="memitem:a98b95a8d47df6cf9155bd7fdb2e0006e" id="r_a98b95a8d47df6cf9155bd7fdb2e0006e"><td class="memItemLeft" align="right" valign="top"><a id="a98b95a8d47df6cf9155bd7fdb2e0006e" name="a98b95a8d47df6cf9155bd7fdb2e0006e"></a>
JackState&#160;</td><td class="memItemRight" valign="bottom"><b>jackStatesB</b> [numSensors]</td></tr>
<tr class="memitem:a53c37e66332cdf830386d34ffde1966c" id="r_a53c37e66332cdf830386d34ffde1966c"><td class="memItemLeft" align="right" valign="top"><a id="a53c37e66332cdf830386d34ffde1966c" name="a53c37e66332cdf830386d34ffde1966c"></a>
JackState *&#160;</td><td class="memItemRight" valign="bottom"><b>jackStates</b> = jackStatesA</td></tr>
<tr class="memitem:a7f549f5485dbe296bd9304e1402b8b71" id="r_a7f549f5485dbe296bd9304e1402b8b71"><td class="memItemLeft" align="right" valign="top"><a id="a7f549f5485dbe296bd9304e1402b8b71" name="a7f549f5485dbe296bd9304e1402b8b71"></a>
JackState *&#160;</td><td class="memItemRight" valign="bottom"><b>prevStates</b> = jackStatesB</td></tr>
<tr class="memitem:abb63b0ee81efd7f16c530fa52b529eb7" id="r_abb63b0ee81efd7f16c530fa52b529eb7"><td class="memItemLeft" align="right" valign="top"><a id="abb63b0ee81efd7f16c530fa52b529eb7" name="abb63b0ee81efd7f16c530fa52b529eb7"></a>
JackState *&#160;</td><td class="memItemRight" valign="bottom"><b>tempStatePointer</b></td></tr>
<tr class="memitem:a1125d5aa8dbbdbecdf3cd09791c73452" id="r_a1125d5aa8dbbdbecdf3cd09791c73452"><td class="memItemLeft" align="right" valign="top"><a id="a1125d5aa8dbbdbecdf3cd09791c73452" name="a1125d5aa8dbbdbecdf3cd09791c73452"></a>
const size_t&#160;</td><td class="memItemRight" valign="bottom"><b>ledPin</b> = 9</td></tr>
<tr class="memitem:a398e545edbb7126eb4c219453a8ce64d" id="r_a398e545edbb7126eb4c219453a8ce64d"><td class="memItemLeft" align="right" valign="top"><a id="a398e545edbb7126eb4c219453a8ce64d" name="a398e545edbb7126eb4c219453a8ce64d"></a>
unsigned long&#160;</td><td class="memItemRight" valign="bottom"><b>now</b> = 0</td></tr>
<tr class="memitem:a678fc66c961e91f8cf97fae1779822ad" id="r_a678fc66c961e91f8cf97fae1779822ad"><td class="memItemLeft" align="right" valign="top"><a id="a678fc66c961e91f8cf97fae1779822ad" name="a678fc66c961e91f8cf97fae1779822ad"></a>
const byte&#160;</td><td class="memItemRight" valign="bottom"><b>ROTARY_PINC</b> = 12</td></tr>
<tr class="memitem:a07bf86313de6b9158d19ee4239f92cf2" id="r_a07bf86313de6b9158d19ee4239f92cf2"><td class="memItemLeft" align="right" valign="top"><a id="a07bf86313de6b9158d19ee4239f92cf2" name="a07bf86313de6b9158d19ee4239f92cf2"></a>
const byte&#160;</td><td class="memItemRight" valign="bottom"><b>ROTARY_PINA</b> = 10</td></tr>
<tr class="memitem:a40b180bf97a34bdf8f59160e8c8f13ea" id="r_a40b180bf97a34bdf8f59160e8c8f13ea"><td class="memItemLeft" align="right" valign="top"><a id="a40b180bf97a34bdf8f59160e8c8f13ea" name="a40b180bf97a34bdf8f59160e8c8f13ea"></a>
const byte&#160;</td><td class="memItemRight" valign="bottom"><b>ROTARY_PINB</b> = 11</td></tr>
<tr class="memitem:ab559a975ca709edddd828d0135765fc4" id="r_ab559a975ca709edddd828d0135765fc4"><td class="memItemLeft" align="right" valign="top"><a id="ab559a975ca709edddd828d0135765fc4" name="ab559a975ca709edddd828d0135765fc4"></a>
const byte&#160;</td><td class="memItemRight" valign="bottom"><b>CLICKS_PER_STEP</b> = 4</td></tr>
<tr class="memitem:affeefb54d0002700c8a1b1f46068a4fe" id="r_affeefb54d0002700c8a1b1f46068a4fe"><td class="memItemLeft" align="right" valign="top"><a id="affeefb54d0002700c8a1b1f46068a4fe" name="affeefb54d0002700c8a1b1f46068a4fe"></a>
const byte&#160;</td><td class="memItemRight" valign="bottom"><b>MIN_POS</b> = 0</td></tr>
<tr class="memitem:a673e552fb40f167349b378044153a747" id="r_a673e552fb40f167349b378044153a747"><td class="memItemLeft" align="right" valign="top"><a id="a673e552fb40f167349b378044153a747" name="a673e552fb40f167349b378044153a747"></a>
const uint16_t&#160;</td><td class="memItemRight" valign="bottom"><b>MAX_POS</b> = numSensors - 1</td></tr>
<tr class="memitem:ac2b2e16d3f172efa1c953b8532dc8a25" id="r_ac2b2e16d3f172efa1c953b8532dc8a25"><td class="memItemLeft" align="right" valign="top"><a id="ac2b2e16d3f172efa1c953b8532dc8a25" name="ac2b2e16d3f172efa1c953b8532dc8a25"></a>
const byte&#160;</td><td class="memItemRight" valign="bottom"><b>START_POS</b> = 0</td></tr>
<tr class="memitem:ad621da47c137c0e5fcbe928ead6cf047" id="r_ad621da47c137c0e5fcbe928ead6cf047"><td class="memItemLeft" align="right" valign="top"><a id="ad621da47c137c0e5fcbe928ead6cf047" name="ad621da47c137c0e5fcbe928ead6cf047"></a>
const byte&#160;</td><td class="memItemRight" valign="bottom"><b>INCREMENT</b> = 1</td></tr>
<tr class="memitem:a233047edcfceb1bce57e81754b7ed32f" id="r_a233047edcfceb1bce57e81754b7ed32f"><td class="memItemLeft" align="right" valign="top"><a id="a233047edcfceb1bce57e81754b7ed32f" name="a233047edcfceb1bce57e81754b7ed32f"></a>
Rotary&#160;</td><td class="memItemRight" valign="bottom"><b>rotary</b> = Rotary(ROTARY_PINA, ROTARY_PINB, CLICKS_PER_STEP, MIN_POS, MAX_POS, START_POS, INCREMENT)</td></tr>
<tr class="memitem:a9542a4e670b62b37e8ab01e0e7d993d8" id="r_a9542a4e670b62b37e8ab01e0e7d993d8"><td class="memItemLeft" align="right" valign="top"><a id="a9542a4e670b62b37e8ab01e0e7d993d8" name="a9542a4e670b62b37e8ab01e0e7d993d8"></a>
Button2&#160;</td><td class="memItemRight" valign="bottom"><b>button</b> = Button2(ROTARY_PINC)</td></tr>
<tr class="memitem:ac6a26c8078b1caea4860f1750d2ab697" id="r_ac6a26c8078b1caea4860f1750d2ab697"><td class="memItemLeft" align="right" valign="top"><a id="ac6a26c8078b1caea4860f1750d2ab697" name="ac6a26c8078b1caea4860f1750d2ab697"></a>
const uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>FRAM_CS</b> = 2</td></tr>
<tr class="memitem:a99b4df70fd37a359933a7cb5858dc48a" id="r_a99b4df70fd37a359933a7cb5858dc48a"><td class="memItemLeft" align="right" valign="top"><a id="a99b4df70fd37a359933a7cb5858dc48a" name="a99b4df70fd37a359933a7cb5858dc48a"></a>
const uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>FRAM_MOSI</b> = 3</td></tr>
<tr class="memitem:af4af8a6d754455be384f1b9cb747e49f" id="r_af4af8a6d754455be384f1b9cb747e49f"><td class="memItemLeft" align="right" valign="top"><a id="af4af8a6d754455be384f1b9cb747e49f" name="af4af8a6d754455be384f1b9cb747e49f"></a>
const uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>FRAM_MISO</b> = 4</td></tr>
<tr class="memitem:a79c95394757f1b45d0d1ee4c647eff95" id="r_a79c95394757f1b45d0d1ee4c647eff95"><td class="memItemLeft" align="right" valign="top"><a id="a79c95394757f1b45d0d1ee4c647eff95" name="a79c95394757f1b45d0d1ee4c647eff95"></a>
const uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>FRAM_SCK</b> = 5</td></tr>
<tr class="memitem:a8a4efd61bf1d4b98c665f4ec3dfc1fc5" id="r_a8a4efd61bf1d4b98c665f4ec3dfc1fc5"><td class="memItemLeft" align="right" valign="top"><a id="a8a4efd61bf1d4b98c665f4ec3dfc1fc5" name="a8a4efd61bf1d4b98c665f4ec3dfc1fc5"></a>
Adafruit_FRAM_SPI&#160;</td><td class="memItemRight" valign="bottom"><b>fram</b> = Adafruit_FRAM_SPI(FRAM_SCK, FRAM_MISO, FRAM_MOSI, FRAM_CS)</td></tr>
<tr class="memitem:a934efcb08050000c829a4d45dc608e2d" id="r_a934efcb08050000c829a4d45dc608e2d"><td class="memItemLeft" align="right" valign="top"><a id="a934efcb08050000c829a4d45dc608e2d" name="a934efcb08050000c829a4d45dc608e2d"></a>
const uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>addrSizeInBytes</b> = 2</td></tr>
<tr class="memitem:a2b9bcde1ab694a602b57787514728e99" id="r_a2b9bcde1ab694a602b57787514728e99"><td class="memItemLeft" align="right" valign="top"><a id="a2b9bcde1ab694a602b57787514728e99" name="a2b9bcde1ab694a602b57787514728e99"></a>
const uint16_t&#160;</td><td class="memItemRight" valign="bottom"><b>tagAddress</b> = 0</td></tr>
<tr class="memitem:a2e7fd017737e03e595f4716ad70afbc2" id="r_a2e7fd017737e03e595f4716ad70afbc2"><td class="memItemLeft" align="right" valign="top"><a id="a2e7fd017737e03e595f4716ad70afbc2" name="a2e7fd017737e03e595f4716ad70afbc2"></a>
const uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>thresholdTag</b> [4] = { 'D', 'A', 'T', 'A' }</td></tr>
<tr class="memitem:add0cb8b757aebfd14b4bc401cfe0de12" id="r_add0cb8b757aebfd14b4bc401cfe0de12"><td class="memItemLeft" align="right" valign="top"><a id="add0cb8b757aebfd14b4bc401cfe0de12" name="add0cb8b757aebfd14b4bc401cfe0de12"></a>
const uint16_t&#160;</td><td class="memItemRight" valign="bottom"><b>pluckValAddress</b> = tagAddress + 4</td></tr>
<tr class="memitem:ab2897ee8614e28ad249dfa8924d49dfc" id="r_ab2897ee8614e28ad249dfa8924d49dfc"><td class="memItemLeft" align="right" valign="top"><a id="ab2897ee8614e28ad249dfa8924d49dfc" name="ab2897ee8614e28ad249dfa8924d49dfc"></a>
unsigned long&#160;</td><td class="memItemRight" valign="bottom"><b>times</b> [1024] = {0}</td></tr>
<tr class="memitem:ac147a4adeae06012d94101eb657d5e14" id="r_ac147a4adeae06012d94101eb657d5e14"><td class="memItemLeft" align="right" valign="top"><a id="ac147a4adeae06012d94101eb657d5e14" name="ac147a4adeae06012d94101eb657d5e14"></a>
USBMIDI&#160;</td><td class="memItemRight" valign="bottom"><b>MidiUSB</b></td></tr>
<tr class="memdesc:ac147a4adeae06012d94101eb657d5e14"><td class="mdescLeft">&#160;</td><td class="mdescRight">MIDI Communication over USB Object, see the PluggableUSBMIDI library. <br /></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Main firmware file for Arduino IDE. </p>
<p>This is the full firmware for the haptic harpsochord using the arduino IDE development platform</p>
<p>At time of writing the microcontroller for the project is not fixed. As such there may be macros to help make the correct changes to firmware behaviour.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md0"></a>
Pinout</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadRight">Connection  </th><th class="markdownTableHeadRight">Pin Left  </th><th class="markdownTableHeadLeft">Pin Right  </th><th class="markdownTableHeadLeft">Connection  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">EEPROM SPI CLK  </td><td class="markdownTableBodyRight">D13  </td><td class="markdownTableBodyLeft">D12  </td><td class="markdownTableBodyLeft">Rotary CLK  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">EEPROM VCC  </td><td class="markdownTableBodyRight">3.3v  </td><td class="markdownTableBodyLeft">D11  </td><td class="markdownTableBodyLeft">Rotary DATA  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">NC  </td><td class="markdownTableBodyRight">AREF  </td><td class="markdownTableBodyLeft">D10  </td><td class="markdownTableBodyLeft">Rotary Switch  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">PCB 0  </td><td class="markdownTableBodyRight">A0  </td><td class="markdownTableBodyLeft">D9  </td><td class="markdownTableBodyLeft">LED Data  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">PCB 1  </td><td class="markdownTableBodyRight">A1  </td><td class="markdownTableBodyLeft">D8  </td><td class="markdownTableBodyLeft">Mux C  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">PCB 2  </td><td class="markdownTableBodyRight">A2  </td><td class="markdownTableBodyLeft">D7  </td><td class="markdownTableBodyLeft">Mux B  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">PCB 3  </td><td class="markdownTableBodyRight">A3  </td><td class="markdownTableBodyLeft">D6  </td><td class="markdownTableBodyLeft">Mux A  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">PCB 4  </td><td class="markdownTableBodyRight">A4  </td><td class="markdownTableBodyLeft">D5  </td><td class="markdownTableBodyLeft">Mux Interrupt  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">PCB 5  </td><td class="markdownTableBodyRight">A5  </td><td class="markdownTableBodyLeft">D4  </td><td class="markdownTableBodyLeft">EEPROM SPI MISO  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">PCB 6  </td><td class="markdownTableBodyRight">A6  </td><td class="markdownTableBodyLeft">D3  </td><td class="markdownTableBodyLeft">EEPROM SPI MOSI  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">NC  </td><td class="markdownTableBodyRight">A7  </td><td class="markdownTableBodyLeft">D2  </td><td class="markdownTableBodyLeft">EEPROM SPI CS  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">NC  </td><td class="markdownTableBodyRight">5v  </td><td class="markdownTableBodyLeft">GND  </td><td class="markdownTableBodyLeft">GND  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">NC  </td><td class="markdownTableBodyRight">RESET  </td><td class="markdownTableBodyLeft">RST  </td><td class="markdownTableBodyLeft">Reset Switch  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyRight">GND  </td><td class="markdownTableBodyRight">GND  </td><td class="markdownTableBodyLeft">RX / D1  </td><td class="markdownTableBodyLeft">NC  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyRight">PSU <span class="tt">+</span>  </td><td class="markdownTableBodyRight">VIN  </td><td class="markdownTableBodyLeft">TX / D0  </td><td class="markdownTableBodyLeft">NC  </td></tr>
</table>
<dl class="section date"><dt>Date</dt><dd>2025-10-11 </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Matthew Hamilton </dd></dl>
</div><a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="aaf407bc928ce2693bc7c429fea80687b" name="aaf407bc928ce2693bc7c429fea80687b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf407bc928ce2693bc7c429fea80687b">&#9670;&#160;</a></span>index2key()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">byte index2key </td>
          <td>(</td>
          <td class="paramtype">byte</td>          <td class="paramname"><span class="paramname"><em>i</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel constexpr">constexpr</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Translate from key index to key number. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">i</td><td>key index </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>key number as it appears on the interface </dd></dl>

</div>
</div>
<a id="a60ca3459b8849ad227d7927987577bfe" name="a60ca3459b8849ad227d7927987577bfe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a60ca3459b8849ad227d7927987577bfe">&#9670;&#160;</a></span>index2note()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">byte index2note </td>
          <td>(</td>
          <td class="paramtype">byte</td>          <td class="paramname"><span class="paramname"><em>index</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">byte</td>          <td class="paramname"><span class="paramname"><em>transpose</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Translate between key index and note. </p>
<p>Overrides for short octave or transposition should happen here Currently hard cded to start from C3</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">index</td><td>key index </td></tr>
    <tr><td class="paramname">transpose</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>byte </dd></dl>

</div>
</div>
<a id="a9d70beff701e3b597b75e1e814f88f17" name="a9d70beff701e3b597b75e1e814f88f17"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d70beff701e3b597b75e1e814f88f17">&#9670;&#160;</a></span>key2index()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">byte key2index </td>
          <td>(</td>
          <td class="paramtype">byte</td>          <td class="paramname"><span class="paramname"><em>k</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel constexpr">constexpr</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Key number to keyindex. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">k</td><td>Key number on interface </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>corrresponding key index used in threshold arrays </dd></dl>

</div>
</div>
<a id="ab87f324bc11121b845d0d6bd14708954" name="ab87f324bc11121b845d0d6bd14708954"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab87f324bc11121b845d0d6bd14708954">&#9670;&#160;</a></span>rotate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rotate </td>
          <td>(</td>
          <td class="paramtype">Rotary &amp;</td>          <td class="paramname"><span class="paramname"><em>r</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Rotate callback. </p>
<p>Effect of rotation based on value of <span class="tt">isKeySelectMode</span>. Either selects the key to calibrate or changes the threshold value.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">r</td><td>reference to a Rotary library rotary object, which interfaces with the rotary encoder. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a4fc01d736fe50cf5b977f755b675f11d" name="a4fc01d736fe50cf5b977f755b675f11d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fc01d736fe50cf5b977f755b675f11d">&#9670;&#160;</a></span>setup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setup </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Arduino setup function. </p>
<p>Initalises all peripheral components and listen if the rotary encoder button has been pressed to enter debug mode. </p>
<p>setup mux</p>
<p>init LEDs</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a href="../../dir_311baebb110acf98635f6859a30c5ba6.html">haptic_harpsichord</a></li><li class="navelem"><a href="../../d1/d58/haptic__harpsichord_8ino.html">haptic_harpsichord.ino</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
